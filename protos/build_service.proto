syntax = "proto3";

package buildservice;

service BuildService {
  rpc Build(BuildRequest) returns (BuildResponse) {}
  rpc PollBuild(PollBuildRequest) returns (PollBuildResponse) {}
  rpc DeployAgent(DeployAgentRequest) returns (DeployAgentResponse) {}
  rpc DeleteAgent(DeleteAgentRequest) returns (DeleteAgentResponse) {}
}

// Request to build a container from a git repository
message BuildRequest {
  string name = 1;
  string git_repo = 2;
  string dockerfile_path = 3;
  string context_sub_path = 4;
}

message BuildResponse {
  enum Status {
    SUCCESS = 0;
    ERROR = 1;
  }
  
  Status status = 1;
  string message = 2;
  string build_id = 3;
}

// Request to poll the status of a build job
message PollBuildRequest {
  string build_id = 1;
}

message PollBuildResponse {
  enum Status {
    SUCCESS = 0;
    ERROR = 1;
  }
  
  enum BuildStatus {
    UNKNOWN = 0;
    RUNNING = 1;
    SUCCEEDED = 2;
    FAILED = 3;
  }
  
  Status status = 1;
  string message = 2;
  BuildStatus build_status = 3;
}

// Request to deploy an agent
message DeployAgentRequest {
  string name = 1;
}

message DeployAgentResponse {
  enum Status {
    SUCCESS = 0;
    ERROR = 1;
  }
  
  Status status = 1;
  string message = 2;
}

// Request to delete an agent deployment
message DeleteAgentRequest {
  string name = 1;
}

message DeleteAgentResponse {
  enum Status {
    SUCCESS = 0;
    ERROR = 1;
  }
  
  Status status = 1;
  string message = 2;
}

