# fly.toml app configuration file for achtung-registry
#
# See https://fly.io/docs/reference/configuration/ for information about how to use this file.
#

app = 'achtung-registry'
primary_region = 'arn'

[build]
dockerfile = '../apps/registry/Dockerfile'

[env]
# Registry storage configuration
REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY = "/var/lib/registry"

# Token authentication configuration
REGISTRY_AUTH = "token"
REGISTRY_AUTH_TOKEN_REALM = "https://achtung.fly.dev/registry/token"
REGISTRY_AUTH_TOKEN_SERVICE = "achtung-registry.fly.dev"
REGISTRY_AUTH_TOKEN_ISSUER = "registry-auth"

# HTTP configuration
# REGISTRY_HTTP_ADDR = "0.0.0.0:5000"
# REGISTRY_HTTP_SECRET = "replace-with-random-secret-string"

[[mounts]]
source = 'registry_data'
destination = '/var/lib/registry'
initial_size = '10gb'

[http_service]
internal_port = 5000
force_https = true
auto_stop_machines = 'stop'
auto_start_machines = true
max_machines_running = 1
min_machines_running = 0
processes = ['app']

[[http_service.checks]]
grace_period = "10s"
interval = "30s"
method = "GET"
timeout = "5s"
path = "/"

[[vm]]
size = 'shared-cpu-1x'
